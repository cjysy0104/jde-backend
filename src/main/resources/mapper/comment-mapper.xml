<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kh.jde.comment.model.dao.CommentMapper">
	
	<!-- 리뷰 존재 확인 -->
	<select id="existsComment" resultType="CommentDTO">
		SELECT
				  TC.COMMENT_NO commentNo
				, TC.REVIEW_NO reviewNo
				, TC.CONTENT content
				, TC.COMMENT_DATE commentDate
		        , (
		            SELECT COUNT(*)
		            FROM TB_COMMENT_LIKE TCL
		            WHERE TCL.COMMENT_NO = TC.COMMENT_NO
		          ) likeCount
		    FROM
		          TB_COMMENT TC
		    WHERE
		          TC.REVIEW_NO = #{reviewNo}
    </select>
    
    <select id="getCommentList"
	        parameterType="Long"
	        resultType="CommentDTO">

		SELECT
				  TC.COMMENT_NO commentNo
				, TC.REVIEW_NO reviewNo
				, TC.CONTENT content
				, TC.COMMENT_DATE commentDate
		        , (
		            SELECT COUNT(*)
		            FROM TB_COMMENT_LIKE TCL
		            WHERE TCL.COMMENT_NO = TC.COMMENT_NO
		          ) likeCount
		    FROM
		          TB_COMMENT TC
		    WHERE
		          TC.REVIEW_NO = #{reviewNo}
		    AND
		          TC.STATUS = 'Y'
		    ORDER
		    BY
		          TC.COMMENT_DATE ASC
	
	</select>

	<insert id="create"
			parameterType="CommentVO">
		INSERT
		INTO
				TB_COMMENT
				(
				  COMMENT_NO
				, MEMBER_NO
				, REVIEW_NO
				, CONTENT
				, COMMENT_DATE
				, STATUS
				)
		VALUES
				(
				  SEQ_COMMENT.NEXTVAL
				, #{memberNo}
				, #{reviewNo}
				, #{content}
				, SYSDATE
				, DEFAULT
				)
	</insert>













</mapper>